<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for Data.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="prettify.css" />
    <link rel="stylesheet" href="base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="index.html">hsDatab: All files</a> Data.ts
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">97.75% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>217/222</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">90.13% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>137/152</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>44/44</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">98.85% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>172/174</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">122x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">73x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">122x</span>
<span class="cline-any cline-yes">122x</span>
<span class="cline-any cline-yes">122x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">121x</span>
<span class="cline-any cline-yes">121x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">95x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-yes">56x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">788x</span>
<span class="cline-any cline-yes">788x</span>
<span class="cline-any cline-yes">787x</span>
<span class="cline-any cline-yes">787x</span>
<span class="cline-any cline-yes">787x</span>
<span class="cline-any cline-yes">787x</span>
<span class="cline-any cline-yes">787x</span>
<span class="cline-any cline-yes">787x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">788x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1093x</span>
<span class="cline-any cline-yes">1093x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1087x</span>
<span class="cline-any cline-yes">1087x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">488x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18x</span>
<span class="cline-any cline-yes">18x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12x</span>
<span class="cline-any cline-yes">12x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11x</span>
<span class="cline-any cline-yes">11x</span>
<span class="cline-any cline-yes">11x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">20x</span>
<span class="cline-any cline-yes">20x</span>
<span class="cline-any cline-yes">20x</span>
<span class="cline-any cline-yes">20x</span>
<span class="cline-any cline-yes">20x</span>
<span class="cline-any cline-yes">17x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">122x</span>
<span class="cline-any cline-yes">785x</span>
<span class="cline-any cline-yes">785x</span>
<span class="cline-any cline-yes">2256x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">785x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">10x</span>
<span class="cline-any cline-yes">10x</span>
<span class="cline-any cline-yes">25x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-yes">12x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">122x</span>
<span class="cline-any cline-yes">122x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2691x</span>
<span class="cline-any cline-yes">1894x</span>
<span class="cline-any cline-yes">1894x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">122x</span>
<span class="cline-any cline-yes">122x</span>
<span class="cline-any cline-yes">122x</span>
<span class="cline-any cline-yes">785x</span>
<span class="cline-any cline-yes">122x</span>
<span class="cline-any cline-yes">785x</span>
<span class="cline-any cline-yes">122x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">785x</span>
<span class="cline-any cline-yes">785x</span>
<span class="cline-any cline-yes">785x</span>
<span class="cline-any cline-yes">3925x</span>
<span class="cline-any cline-yes">3925x</span>
<span class="cline-any cline-yes">3925x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">785x</span>
<span class="cline-any cline-yes">2256x</span>
<span class="cline-any cline-yes">2256x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">785x</span>
<span class="cline-any cline-yes">3614x</span>
<span class="cline-any cline-yes">3614x</span>
<span class="cline-any cline-yes">3470x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">785x</span>
<span class="cline-any cline-yes">785x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2256x</span>
<span class="cline-any cline-yes">2051x</span>
<span class="cline-any cline-yes">1761x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1396x</span>
<span class="cline-any cline-yes">1396x</span>
<span class="cline-any cline-yes">1155x</span>
<span class="cline-any cline-yes">965x</span>
<span class="cline-any cline-yes">822x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">434x</span>
<span class="cline-any cline-yes">47x</span>
<span class="cline-any cline-yes">48x</span>
<span class="cline-any cline-yes">339x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">300x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">785x</span>
<span class="cline-any cline-yes">785x</span>
<span class="cline-any cline-yes">2256x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1230x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1210x</span>
<span class="cline-any cline-yes">1210x</span>
<span class="cline-any cline-yes">776x</span>
<span class="cline-any cline-yes">776x</span>
<span class="cline-any cline-yes">680x</span>
<span class="cline-any cline-yes">680x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1230x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2256x</span>
<span class="cline-any cline-yes">2256x</span>
<span class="cline-any cline-yes">678x</span>
<span class="cline-any cline-yes">388x</span>
<span class="cline-any cline-yes">388x</span>
<span class="cline-any cline-yes">388x</span>
<span class="cline-any cline-yes">190x</span>
<span class="cline-any cline-yes">190x</span>
<span class="cline-any cline-yes">190x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190x</span>
<span class="cline-any cline-yes">190x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">190x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1049x</span>
<span class="cline-any cline-yes">1049x</span>
<span class="cline-any cline-yes">1049x</span>
<span class="cline-any cline-yes">339x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1966x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/**
 */
&nbsp;
 /** */
import { Condition, filter } from './DataFilters';
import { log as _log}        from 'hsutil'; const log = _log('hsData');
&nbsp;
/** defines a [min-max] range */
export type NumRange = [number, number];
&nbsp;
/** defines a numeric domain that includes all values of a column */
export type NumDomain = [number, number];
&nbsp;
/** defines a Date domain that includes all values of a column */
export type DateDomain = [Date, Date];
&nbsp;
/** defines a categorical domain that includes all values of a column */
export type NameDomain = string[];
&nbsp;
/** defines a generic domain that can be any of the typed domains. */
export type Domain = NumDomain | DateDomain | NameDomain;
&nbsp;
/** defines a Column Reference, either as column name or index in the {@link Data.DataRow `DataRow`} array */
export type ColumnReference = number|string;
&nbsp;
/** a generic data value type, used in the {@link Data.DataRow `DataRow`} array */
export type DataVal = number|string|Date;
&nbsp;
/** a single row of column values */
export type DataRow = DataVal[];
&nbsp;
/** a JSON format data set, using arrays of names and rows */
export interface DataSet {
    /** an optional name for the data set */
    name?:  string;
    /** an array of column names. Each name matches the column with the same index in DataRow */
    colNames:  string[];   
    /** rows of data */
    rows:   DataRow[];
}
&nbsp;
/** a JSON format data set, using an array of {name:value, ...} literals*/
export type DataTable = (string|number)[][];
&nbsp;
interface TypeStruct { type: string; count: number;}
&nbsp;
interface MetaStruct {
    name:       string;         // column name
    column:     number;         // column index
    accessed:   boolean;        // has column data been accessed?
    cast:       boolean;        // has column data been cast 
    types:      TypeStruct[];   // data types, sorted by likelihood
}
&nbsp;
export type sortFn   = (x:any, y:any) =&gt; number;
export type mapFn    = (colVal:DataVal, colIndex:number, rowIndex:number, rows:DataRow[]) =&gt; DataVal;
export type mapRowFn = (row:DataRow, rowIndex:number, rows:DataRow[]) =&gt; DataRow;
export type initFn   = (colVal: DataVal, colIndex:number, row:DataRow) =&gt; DataVal;
    
export type DataType = string;
&nbsp;
/**
 * # Data
 * A simple in-memory database that holds data in rows of columns.
 * 
 */
export class Data {
    //----------------------------
    // public part
    //----------------------------
    public static type = {
        /** numeric values */
        number:     &lt;DataType&gt;'number',
        /** nominal values, represented by arbitrary words */
        name:       &lt;DataType&gt;'name',
        /** date values */
        date:       &lt;DataType&gt;'date',
        /** currency values. Currently support6ed are values ofg the format '$dd[,ddd]' */
        currency:   &lt;DataType&gt;'currency',
        /** percent values: 'd%' */
        percent:    &lt;DataType&gt;'percent',
//        nominal:    'nominal'
    };
&nbsp;
    constructor(dataset?:DataSet|DataTable) {
        <span class="missing-if-branch" title="else path not taken" >E</span>if (dataset) { this.importData(dataset); }
    }
&nbsp;
    /**
     * @return the `name` field for this data base, if any
     */
    public getName():string {
        return this.name;
    }
&nbsp;
    /**
     * Imports data from an object literal or an array whos header row contains the column numbers
     * @param data the data set to import
     */
    public importData(dataset:DataSet|DataTable) {
        this.name = 'data'+(Math.round(1000*Math.random()));
        <span class="missing-if-branch" title="else path not taken" >E</span>if (dataset) {
            if (dataset instanceof Array) {
                const names = &lt;string[]&gt;dataset[0];
                const rows = dataset.slice(1);
                this.setData(rows, names);
            } else {
                if (dataset.name) { this.name = dataset.name; }
                this.setData(dataset.rows, dataset.colNames);
            }
        }
    }
&nbsp;
    /**
     * Exports to an object literal
     */
    public export():DataSet {
        return {
            rows: this.getData(),
            colNames:this.colNames()
        };
    }
&nbsp;
    /**
     * returns the 2D array underlying the data base.
     */
    public getData():DataRow[] {
        return this.data;
    }
&nbsp;
    /**
     * Returns the values in the specified column as a new array.
     * @param col the column to return.
     */
    public getColumn(col:ColumnReference): DataVal[] {
        const cn = this.colNumber(col);
        return this.data.map((row:DataRow) =&gt; row[cn]);
    }
&nbsp;
    /**
     * adds a new column to the data set. if `newCol` already exists, 
     * the column index is returned without change.
     * @param col the name of the new column
     * @return the index for the new column
     */
    public colAdd(col:string):MetaStruct {
        let m = this.getMeta(col);
        if (m === undefined) { 
            m = this.meta[col] = &lt;MetaStruct&gt;{};
            m.name   = col; 
            m.column = this.meta.length;
            this.meta.push(m);      // access name by both column name and index
            m.cast 	   = false;     // has not been cast yet
            m.accessed = false;     // has not been accessed yet
        }
        return m;
    }
&nbsp;
    /**
     * initializes the specifed column with values, adding a new column if needed. 
     * If `val`is a function, it is called as ```
     * val(colValue:DataVal, rowIndex:number, row:DataRow)
     * ```
     * @param col the column to initialize
     * @param initializer the value to initialize with, or a function whose return
     * value is used to initialize the column
     * @return the initialized column number
     */
    public colInitialize(col:ColumnReference, initializer:initFn|DataVal):number {
        const fn = typeof initializer === 'function';
        let cn:MetaStruct = this.getMeta(col);
        if (!cn) {
            if (typeof col === 'string') { cn = this.colAdd(col); }
            else { throw new Error(`column ${col} does not exist in Data`); }
        }
        this.data.map((row:DataRow, rowIndex:number) =&gt;
            row[cn.column] = fn? (&lt;initFn&gt;initializer)(row[cn.column], rowIndex, row) : &lt;DataVal&gt;initializer
        );
        return cn.column;
    }
&nbsp;
    /**
     * returns the column index of the specified column. 
     * `col` can be either an index or a name.
     * @param column the data column, name or index, for which to return the index. 
     * @return the column number or `undefined`.
     */
    public colNumber(col:ColumnReference) {
        const m = this.getMeta(col);
        if (!m) { return undefined; }
        else {
            m.accessed = true; 
            return m.column; 
        }
    }
    
    /**
     * returns the column name for the specified column. 
     * `col` can be either an index or a name.
     * @param column the data column, name or index. 
     * @return the column name or `undefined`.
     */
    public colName(col:ColumnReference):string {
        var m = this.getMeta(col);
        if (!m) { return undefined; }
        m.accessed = true; 
        return m.name; 
    }
&nbsp;
    /**
     * returns the names for all columns. 
     * @return an array of strings with the names.
     */
    public colNames():string[] {
        return this.meta.map((m:MetaStruct) =&gt; m.name); 
    }
&nbsp;
    /**
     * returns the column type for the specified column. 
     * `col` can be either an index or a name.
     * @param column the data column, name or index. 
     * @return the column type.
     */
    public colType(col:ColumnReference):DataType { 
        const meta = this.getMeta(col);
        return meta? meta.types[0].type : Data.type.name;
    }
&nbsp;
    /**
     * modifies `domain` to include all values in column `col`.
     * If no `col` is specified, the range of data indexes is returned.
     * @param col optional; the column name or index 
     * @param domain optional; the Domain range to update
     * @return the updated domain
     */
    public findDomain(col?:ColumnReference, domain?:Domain):Domain {
        if (domain===undefined) { domain = &lt;Domain&gt;[]; }
        if (col === undefined) { // use array index as domain
            domain[0] = 0;
            domain[1] = this.data.length-1;
        } else {
            const c = this.colNumber(col);
            const type = this.colType(col);
            switch(type) {
                case Data.type.name: 
                    this.data.forEach((r:DataRow) =&gt; {
                        const nomDom = &lt;string[]&gt;domain;
                        <span class="missing-if-branch" title="else path not taken" >E</span>if (nomDom.indexOf(''+r[c]) &lt; 0) { nomDom.push(''+r[c]); }
                    });
                    break;
                case Data.type.date: 
                    this.data.forEach((r:DataRow) =&gt; {
                        let v:Date = this.toDate(r[c]);
                        if (domain[0]===undefined) { domain[0] = v; }
                        if (domain[1]===undefined) { domain[1] = v; }
                        <span class="missing-if-branch" title="else path not taken" >E</span>if (v!==undefined &amp;&amp; v!==null) {
                            if (v&lt;domain[0]) { domain[0] = v; }
                            else if (v&gt;domain[1]) { domain[1] = v; }
                        }
                    });
                    break;
                default: 
                    this.data.forEach((r:DataRow) =&gt; {
                        let v:number = parseFloat(r[c].toString());
                        if (domain[0]===undefined) { domain[0] = v; }
                        if (domain[1]===undefined) { domain[1] = v; }
                        <span class="missing-if-branch" title="else path not taken" >E</span>if (v!==undefined &amp;&amp; v!==null) {
                            if (v&lt;domain[0]) { domain[0] = v; }
                            else if (v&gt;domain[1]) { domain[1] = v; }
                        }
                    });
            }
        }
        return domain;
    }
&nbsp;
    public castData() {
        this.meta.forEach((c:MetaStruct) =&gt; {
            const col = c.column;
            <span class="missing-if-branch" title="else path not taken" >E</span>if (!c.cast) {
                this.data.forEach((row:DataRow) =&gt; row[col] = this.castVal(c.types[0].type, row[col]));
            }
            c.cast = true;
        });
    }
&nbsp;
    /**
     * filters this data set and returns a new data set with a 
     * shallow copy of rows that pass the `condition`.
     * See {@link DataFilters DataFilters} for rules and examples on how to construct conditions.
     * @param condition filters 
     * @return a new Data object with rows that pass the filter
     */
    public filter(condition:Condition):Data {
        return filter(this, condition);
    }
&nbsp;
    /**
     * @description Sorts the rows of values based on the result of the `sortFn`, 
     * which behaves similarly to the Array.sort method.  
     * Two modes are supported:
     * # Array Mode
     * If `col` is omitted, the column arrays are passed as samples into the `sortFn`. 
     * This allows for complex sorts, combining conditions across multiple columns.
     * ```
     * data.sort((row1, row2) =&gt; row1[5] - row2[5] );
     * ```
     * # Column mode
     * If `col` is specified, either as index or by column name, the respective column value is passed
     * into `sortFn`. This allows filtering for simple conditions.
     * **The specified column will be automatically cast prior to sorting**&lt;br&gt;
     * ```
     * data.sort('ascending', 'Date');
     * data.sort('decending', 'Date');
     * data.sort(function(val1, val2) { return val1 - val2; }, 'Date');
     * ```
     * @param col optional; the data column to use for sorting. 
     * @param sortFn a function to implement the conditions, 
     * follows the same specifications as the function passed to Array.sort(). 
     * Some predefined sort function can be invoked by providing a 
     * respective string instead of a function. The following functions are defined:
        ```
        ascending    sort in ascending order.
        descending   sort in decending order.
        ```
     * @return the Data object in order to allow for chaining.
     */
    public sort(sortFn:string|sortFn, col?:ColumnReference):Data {
        let fn = &lt;sortFn&gt;sortFn;
        if (!col) {
            this.data.sort(fn);
        } else {
            col = this.colNumber(col);
            if (sortFn === 'descending') { fn = (a:any, b:any)  =&gt; (b&gt;a)?1:((b&lt;a)?-1:0); }
            if (sortFn === 'ascending')  { fn = (a:any, b:any)  =&gt; (b&lt;a)?1:((b&gt;a)?-1:0); }
            this.data.sort((r1:any[], r2:any[]) =&gt; fn(r1[col], r2[col])); 
        }
        return this;
    }
&nbsp;
    /** 
    *  Maps one or more columns in each rows of values based 
     * on the result of the `mapFn`, which behaves similarly to the Array.map() method.
     * Two modes are supported:
     * 
     * ## Array Mode
     * If `col` is omitted, the `mapFn` is passed the column arrays per row as parameter. 
     * This allows for complex mapping combining conditions across multiple columns.
     * ```
     * data.map(function(values){ 
     *    values[1] = values[3] * values[5]; 
     *    return values; 
     * });
     * ```
     * Be sure to return the `values` array as a result.
     * 
     * ## Column mode
     * If `col` is specified, either as index or by column name, the respective column value is passed
     * into `mapFn`, along with the row index and the entire row array. This allows for simple mapping.
     * ```
     * data.map('Price', function(value, i, values) { 
     *    return value * 2; 
     * });
     * ```
     * @param col the data column, or columns, to apply the mapping to. 
     * @param mapFn a function to implement the mapping,
     * called on each row of the data set in turn as `mapFn(val, i, c, rows)`, where
     * - `val`: the column value in the current row
     * - `c`: the column index in the current row
     * - `i`: the row index 
     * - `rows`: the rows being iterated over
`    * 
     * follows the same specifications as the function passed to Array.map().&lt;br&gt;
     * For column mode, some predefined map functions can be invoked by providing a 
     * respective string instead of a function. The following functions are defined:
     *  &lt;table&gt;
     *  &lt;tr&gt;&lt;td&gt;'noop'&lt;/td&gt;&lt;td&gt;replace value with itself, performing no operation.&lt;/td&gt;&lt;/tr&gt;
     *  &lt;tr&gt;&lt;td&gt;'cumulate'&lt;/td&gt;&lt;td&gt;replace value with the cumulative sum of values up to the current element.&lt;/td&gt;&lt;/tr&gt;
     *  &lt;/table&gt;
     *
     * @return a new Data object containing the mapping.
     */
    public map(mapFn:string|mapFn|mapRowFn, col?:ColumnReference):Data {
        const noop = (val:any) =&gt; val;
        const cumulate = () =&gt; { 
            let sum=0; 
            return (val:number, i:number) =&gt; { sum += +val; return sum; };
        };
        function getFn():mapFn|mapRowFn {
            let fn; // define fn inside each col loop to ensure initialization
            switch (mapFn) {
                case 'cumulate': fn = cumulate(); break;
                case 'noop':     fn = noop; break;
                default:         fn = &lt;mapFn|mapRowFn&gt;mapFn;
            }
            return fn;
        }
&nbsp;
        let fn = getFn(); // define fn inside each col loop to ensure initialization
        const c = col? this.colNumber(col) : undefined;
        let result = new Data({
            colNames:this.colNames(), 
            rows:this.data.map((row:any[], rowIndex:number, rows:any[][]) =&gt; { 
                if (c) {
                    row[c] = (&lt;mapFn&gt;fn)(row[c], c, rowIndex, rows); 
                } else {
                    rows[rowIndex] = (&lt;mapRowFn&gt;fn)(row, rowIndex, rows);
                }
                return row;
            }), 
            name:this.getName()
        });
        return result;
    }
&nbsp;
    //----------------------------
    // private part
    //----------------------------
    private data: DataRow[]    = [];
    private meta: MetaStruct[] = [];
    private name: string;
&nbsp;
    private getMeta(col:ColumnReference):MetaStruct { 
        // if (!this.meta) { this.meta = []; }
        if (!this.meta[col]) { return undefined; }
       	this.meta[col].accessed = true;
        return this.meta[col]; 
    }
&nbsp;
    /**
     * sets `rows` as the data set. A copy of the rows array will be set.
     * @param data the data to add
     * @param names an array of names that match the columns
     * @param autoType unless set to false, the method will attempt to determine the 
     * type of data and automatically cast data points to their correct value
     */
    private setData(rows:DataRow[], names:string[], autoType=true):void {
        this.meta = [];
        this.data = rows.slice();
        <span class="missing-if-branch" title="else path not taken" >E</span>if (names &amp;&amp; names.forEach) {
            names.forEach((col:string) =&gt; this.colAdd(col));
            <span class="missing-if-branch" title="else path not taken" >E</span>if (autoType) { 
                names.forEach((col:string) =&gt; this.findTypes(col)); 
                this.castData();
            }
        } else {
<span class="cstat-no" title="statement not covered" >            log.warn(`invalid names setData:\n${log.inspect(names, 5)}`);</span>
        }
    }
&nbsp;
    /**
     * Determines the type of data in `col`. An array of counts is created for all
     * encountered types, sorted by descending frequency. THe most likely type in position 0
     * of the array is returned.
     * @param col the index of the column to be typed. 
     * @return the most likely type of data in `col`.
     */
    private findTypes(col:ColumnReference):string {
        const m = this.getMeta(col);
        const types:TypeStruct[] = [];
        Object.keys(Data.type).forEach((t:string) =&gt; {
            const ts = { type: Data.type[t], count: 0 }; 
            types.push(ts);
            types[Data.type[t]] = ts;
        });
        for (let v of this.allRows(col)) {
            const t = this.findType(v);
            if (t !== null) { types[t].count++; }
        }
        types.sort(function(a:TypeStruct, b:TypeStruct) { 
            <span class="missing-if-branch" title="if path not taken" >I</span>if (a.type==='currency'&amp;&amp;a.count&gt;0) { <span class="cstat-no" title="statement not covered" >return -1; </span>}
            if (b.type==='currency'&amp;&amp;b.count&gt;0) { return 1; }
            return b.count - a.count;
        });
        m.types = types;
        return types[0].type;
    }
&nbsp;
    /**
     * @description determines the data type. Supported types are 
     * ```
     * 'date':    sample represents a Date, either as a Date object or a String 
     * 'number':  sample represents a number
     * 'percent': sample represents a percentage (special case of a real number)
     * 'nominal': sample represents a nominal (ordinal or categorical) value
     * ```
     * @param val the value to bve typed.
     * @returns the type ('number', 'date', 'percent', 'nominal', 'currency') corresponding to the sample
     */
    private findType(val:DataVal) {
        if (val &amp;&amp; val!=='') {
            if (val instanceof Date) { return Data.type.date; }         // if val is already a date
            if (typeof val === 'number') { return Data.type.number; }   // if val is already a number
            
            // else: val is a string:
            const strVal = ''+val;
            if (''+parseFloat(strVal) === strVal)                              { return Data.type.number; }
            if (strVal.startsWith('$') &amp;&amp; !isNaN(parseFloat(strVal.slice(1)))) { return Data.type.currency; }
            if (strVal.endsWith('%') &amp;&amp; !isNaN(parseFloat(strVal)))            { return Data.type.percent; }
            if (!isNaN(this.toDate(strVal).getTime()))	                       { return Data.type.date; }
&nbsp;
            // // european large number currency representation: '$dd[,ddd]'
            // if ((/^\$\d{0,2}((,\d\d\d)*)/g).test(val)) { 
            //     if (!isNaN(parseFloat(val.trim().replace(/[^eE\+\-\.\d]/g, '').replace(/,/g, '')))) { 
            //         return Data.type.currency; 
            //     }
            // }
            switch (strVal.toLowerCase()) {
                case "null": break;
                case "#ref!": break;
                default: <span class="missing-if-branch" title="else path not taken" >E</span>if (val.length&gt;0) { return Data.type.name; }
            }
        }
        return null;
    }    
&nbsp;
    /**
     * A generator that provides the specified column value for each row in `Data` in sequence. 
     * @param column 
     */
    private * allRows(column:ColumnReference):Iterable&lt;DataVal&gt; {
        const c = this.colNumber(column);
        for (let r=0; r&lt;this.data.length; r++) {
            yield this.data[r][c];
        }
    }
&nbsp;
    /**
     * @param val the string to convert to a date
     * @param limitYear the year below which the century is corrected. Defaults to 1970.
     * @returns a new Date object parsed from `str`.
     * @description returns a new Date object parsed from `str` and corrects for a difference in 
     * interpreting centuries between webkit and mozilla in converting strings to Dates:
     * The string "15/7/03" will convert to Jul 15 1903 in Mozilla and July 15 2003 in Webkit.
     * If `limitYear` is not specified this method uses 1970 as the decision date: 
     * years 00-69 will be interpreted as 2000-2069, years 70-99 as 1970-1999.
     * Specifying a century in the string leads to a correct parse, e.g. "15/7/1903"
     */
    private toDate(val:DataVal, limitYear=1970):Date {
        let d:Date;
        if (val instanceof Date) { d = &lt;Date&gt;val; }
        else { 
            d = new Date(&lt;string&gt;val); 
            if (!isNaN(d.getTime())) {
                const r = new RegExp(`\\d\\d${d.getFullYear() % 100}`, 'g');
                if (!(&lt;string&gt;val).match(r)) {
                    const yr = 1900 + d.getFullYear() % 100;
                    d.setFullYear( (yr &lt; limitYear)? yr+100 : <span class="branch-1 cbranch-no" title="branch not covered" >yr)</span>; 
                }
            }
        }   
        return d;
    }
&nbsp;
    /**
     * @param type ['date' | 'percent' | 'real' | _any_] The type to cast into. In case of _any_ - i.e. `type` 
     * does not match any of the previous keywords, no casting occurs.
     * @param sample The value to cast.
     * @returns The result of the cast. 
     * @description Casts the sample to the specified data type.
     */
    private castVal(type:string, val:DataVal):DataVal {
        let result:DataVal = val;
        switch (type) {
            case Data.type.date:    if (val instanceof Date) { return val; }
                            result = this.toDate(val);
                            <span class="missing-if-branch" title="if path not taken" >I</span>if (isNaN(result.getTime())) { <span class="cstat-no" title="statement not covered" >result = null; </span>}
                            break;
            case Data.type.percent: <span class="missing-if-branch" title="else path not taken" >E</span>if (typeof val === 'string') {
                                const num = parseFloat(val);
                                result = (&lt;string&gt;val).endsWith('%')? num/100 : num;
                            } else {
<span class="cstat-no" title="statement not covered" >                                result = val;</span>
                            }
                            <span class="missing-if-branch" title="if path not taken" >I</span>if (isNaN(&lt;number&gt;result)) { <span class="cstat-no" title="statement not covered" >result = null; </span>}
                            break;
            case Data.type.currency:// replace all except 'e/E', '.', '+/-' and digits
                            result = (typeof val === 'string')? val.replace(/[^eE\+\-\.\d]/g, '') : <span class="branch-1 cbranch-no" title="branch not covered" >val;          				</span>
            				/* falls through */
            case Data.type.number:  if (typeof result === 'string') { result = parseFloat(result); }
                            if (isNaN(&lt;number&gt;result)) { result = null; }
                            break;
            default:        result = ''+val;
        }
        return result;
     }     
}</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->

</div>
<script src="prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="sorter.js"></script>
</body>
</html>

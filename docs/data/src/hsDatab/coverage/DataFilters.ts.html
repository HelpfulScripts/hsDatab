<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for DataFilters.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="prettify.css" />
    <link rel="stylesheet" href="base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="index.html">hsDatab: All files</a> DataFilters.ts
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">96.77% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>60/62</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>38/38</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>8/8</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">95.74% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>45/47</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">271x</span>
<span class="cline-any cline-yes">271x</span>
<span class="cline-any cline-yes">271x</span>
<span class="cline-any cline-yes">271x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">267x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">263x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">336x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">71x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">350x</span>
<span class="cline-any cline-yes">350x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">350x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">346x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">335x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">331x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">331x</span>
<span class="cline-any cline-yes">28x</span>
<span class="cline-any cline-yes">28x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">24x</span>
<span class="cline-any cline-yes">10x</span>
<span class="cline-any cline-yes">28x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">303x</span>
<span class="cline-any cline-yes">303x</span>
<span class="cline-any cline-yes">307x</span>
<span class="cline-any cline-yes">307x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">307x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-yes">12x</span>
<span class="cline-any cline-yes">271x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">307x</span>
<span class="cline-any cline-yes">173x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">303x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">271x</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">276x</span>
<span class="cline-any cline-yes">276x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">&nbsp;
/**
* Use the {@link filter `filter`} function to executes a queries on a {@link Data `Data`} object. 
* Each row in the data is checked and those for which `conditions` holds true are returned as a new `Data` object. 
* 
* # Condition construction
*  
* ### General Condition
* ```
* Condition = 
*    IndexCondition            -&gt; conditions on the row index
* || RecursiveCondition        -&gt; (set of) conditions on column values
* ```
* 
* ### IndexCondition
* ```
* IndexCondition =
*    rowIndex:number           -&gt; true if row index matches
* ```
* 
* ### RecursiveCondition
* ```
* RecursiveCondition =
*    OrCondition               -&gt; OR: true if any compound condition is true
* || AndCondition              -&gt; AND: true if all compound conditions are true
* 
* OrCondition =                -&gt; OR: true if
*    AndCondition[]               -&gt; any of the AndConditions are true
* || IndexCondition[]             -&gt; any of thr IndexConditions are true
* 
* AndCondition =               -&gt; AND: true if
*    SetAndCondition              -&gt; all SetAndConditions are true
* || TermAndCondition             -&gt; or if all TermAndConditions are true
*
* SetAndCondition = {          -&gt; AND: true if all sub-conditions are true
*    'or':  RecursiveCondition    -&gt; true if any RecursiveCondition is true
* || 'and': RecursiveCondition    -&gt; true if all RecursiveCondition are true
* || 'not': RecursiveCondition    -&gt; true if the condition is false
*
* TermAndCondition = {         -&gt; Terminal AND: true if all terminal sub-conditions are true
*    colDesc:colValue             -&gt; true if colValue matches 
* || colDesc:[colValue, ...]      -&gt; true if any of the colValues match
* || colDesc:function(value,row)  -&gt; true if function returns true 
* }
* 
* colDesc = either column name or index
* ```
* 
* ### Practical Tips
* ```
*    {'or': [recurCond, ...]}    -&gt; OR, same as [recurCond, ...]
* || {'or': {SetCond, ...}}      -&gt; OR, same as [SetCond, ...]
* || {'and': [recurCond, ...]}   -&gt; AND, true if all recurCond are true
* || {'and': {SetCond, ...}}     -&gt; AND, same as {SetCond, ...}
* || {'not': {SetCond, ...}}     -&gt; NAND: true if the SetCond are true
* || {'not': [recurCond, ...]}   -&gt; NOR: true if any of the recurCond are true
* ```
*      
* # Example
* &lt;example height=1000px&gt;
* &lt;file name="script.js"&gt;
* const colNames = ['Name', 'Value', 'Start', 'End'];
* const rows = [
*   ['Harry', '100', '3/1/14', '11/20/14'], 
*   ['Mary', '1500', '7/1/14',  '9/30/14'],
*   ['Peter', '400', '5/20/14', '4/30/15'],  
*   ['Jane', '700', '11/13/14', '8/15/15']
* ]
* const data = new hsdatab.Data({colNames:colNames, rows:rows});
* 
* queries = [
*   ['0', undefined,                           'undefined query =&gt; pass all'],
*   ['1', [],                                  'empty OR:  []   =&gt; fail all'],
*   ['2', {},                                  'empty AND: {}   =&gt; pass all'],
*   ['3', 1,                                   '2nd row: pass row 1'],
*   ['4', [1,3],                               '2nd+4th: pass rows: 1 and 3'],
*   ['5', {Name:"Jane"},                       'Name is Jane'],
*   ['6', {1:1500},                            'Column 2 is 1500'],
*   ['7', {Name:["Peter", "Jane"]},            'Name is Peter or Jane'],
*   ['8', [{Name:"Peter"}, {Value:1500}],      'Name is Peter or Value is 1500'],
*   ['9', {or:{Name:"Peter", Value:1500}},     'OR:  same as 8:'],
*   ['A', {or:[{Name:"Peter"}, {Value:1500}]}, 'OR: [{Name is Peter}, {Value is 1500}]'],
*   ['B', {Name:"Peter", Value:400},           'Name is Peter and Value is 400'],
*   ['C', {and:{Name:"Peter", Value:400}},     'AND: {Name is Peter, Value is 400}'],
*   ['D', {and:{Name:"Peter", Value:1500}},    'AND: {Name is Peter, Value is 1500}'],
*   ['E', {and:[{Name:"Peter"}, {Value:400}]}, 'AND:[{Name is Peter}, {Value is 400}]'],
*   ['F', {and:[{Name:"Peter"}, {Value:1500}]},'AND:[{Name is Peter}, {Value is 1500}]'],
*   ['G', {not:{Name:"Peter", Value:400}},     'NAND: not {Name is Peter and Value is 400}'],
*   ['H', {not:{Name:"Peter", Value:1500}},    'NAND: not {Name is Peter and Value is 1500}'],
*   ['I', {not:[{Name:"Peter"}, {Value:1500}]},'NOR: not [{Name is Peter} or {Value is 1500}]'],
*   ['J', {Name:(v) =&gt; v.length===4},          'Name has 4 letters']
* ];
*
* m.mount(root, { 
*   view:() =&gt; m('', [
*       m('h3', 'Given the data set:'),
*       m('table#data', [
*           m('tr', colNames.map(n =&gt; m('th', n))),
*           ...rows.map(row =&gt; m('tr', [m('td', row[0]),m('td', row[1]),m('td', row[2].toDateString()),m('td', row[3].toDateString())]))
*       ]),
*       m('h3', 'The following queries yield:'),
*       m('table', [
*           m('tr', [m('th','#'), m('th','Query'), m('th',"Live Result, by 'Name' field")]),
*           ...queries.map(q =&gt; {
*               const result = data.filter(q[1]).getColumn('Name').join(', ');
*               return m('tr', [m('td',`${q[0]}:`), m('td',`${q[2]}`), m('td',`[ ${result} ]`)]);
*           })
*       ])
*   ])
* });
* &lt;/file&gt;
* &lt;file name='style.css'&gt;
*   $exampleID { height: 600px; }
*   #data th { width:15%; }
*   table { 
*       font-size: 10pt;
*       margin-left: 10px;
*   }
* &lt;/file&gt;
* &lt;/example&gt;     
*/
&nbsp;
/** */
import { Data,
         DataVal,
         DataRow
} from './Data'; 
&nbsp;
export type Condition = IndexCondition | RecursiveCondition;
&nbsp;
/** true if row index matches the number(s) */
export type IndexCondition = number;
&nbsp;
export type RecursiveCondition = AndCondition | OrCondition;
export type OrCondition = AndCondition[] | IndexCondition[];
export type AndCondition = SetAndCondition | TermAndCondition;
&nbsp;
export interface SetAndCondition {
    or?: RecursiveCondition;
    and?:RecursiveCondition;
    not?:RecursiveCondition;
};
&nbsp;
export interface TermAndCondition { 
    [colDesc:string]: 
        DataVal 
      | DataVal[]
      | TermConditionFunction
    ;
};
&nbsp;
export type TermConditionFunction = (value:DataVal, row:DataRow) =&gt; boolean;
&nbsp;
function resolveTerminalCondition(name:string, val:any, row:DataRow, colNumber:(name:string)=&gt;number):boolean { 
    const col = colNumber(name);
    const valIsFunction = (typeof val === 'function');
    const valIsArray = ((typeof val === 'object') &amp;&amp; (val.length!==undefined));
    if (isNaN(col)) { 
        console.log(`column name '${name}' cannot be resolved in terminal condition ${name}=${val}`);
        console.log(row);
        return false; // -&gt; this condition is not met;
    } else if (valIsFunction) { 
        // query true if function evaluates to true
        return val(row[col], row);
    } else if (valIsArray) {
        // query true if empty array, or at least one c true
        return (val.length === 0) || val.some((v:any) =&gt; row[col] === v); 
    } else { // object: all conditions have to be met, unless specified as or
        return (row[col] === val); 
    }
}
&nbsp;
/**
 * applies `condition` to a row of data and returns `true` if the row passes.
 * @param condition the complex condition to test against
 * @param r the row index in the data set
 * @param row the row values 
 * @param and 
 */
function resolveCondition(condition:Condition, row:DataRow, r:number, colNumber:(name:string)=&gt;number, and?:boolean):boolean { 
    let orResult = false;
    let andResult= true;          
    // undefined condition is TRUE
    if (condition===undefined) { return true; }
    
    // Simple Index Condition on row index:
    else if (typeof condition === 'number') { return (condition === r); }
&nbsp;
    // Recursive Condition - OR: [...], AND {...}: 
    else if (typeof condition === 'object') {
        // array -&gt; or condition on a list of row indices or compound conditions
        const mc = &lt;AndCondition[]&gt;condition;
&nbsp;
        // OR condition: [...], or:[], not:[]
        if (mc.length !== undefined) { 
            if (and === undefined) { and = false; }  
            if (mc.length === 0) { return false; }    // empty OR is false:	 
            // else: OR is true if any sub-condition is met    
            return and?
                mc.every((cd:AndCondition) =&gt; resolveCondition(cd, row, r, colNumber, and)) :
                mc.some((cd:AndCondition) =&gt; resolveCondition(cd, row, r, colNumber, and));
        } 
        // AND condition: {...}, and:{}, not:{}
        else { 	
            if (and === undefined) { and = true; }  
            for (const name in condition) {
                let conditionMet = and; // initialize with false for OR, and true for AND conjunction
                const setCond = &lt;SetAndCondition&gt;condition;
                
                // resolve SetConditions:
                switch (name) {
                    case 'or':  conditionMet = resolveCondition(setCond.or, row, r, colNumber, false); break;
                    case 'and': conditionMet = resolveCondition(setCond.and, row, r, colNumber, true); break;
                    case 'not': conditionMet = !resolveCondition(setCond.not, row, r, colNumber); break;
                    default:    conditionMet = resolveTerminalCondition(name, condition[name], row, colNumber); 
                }
                if (conditionMet) { orResult  = true;  if(!and) { break; }} // OR conjunction: exit for name loop if condition met
                             else { andResult = false; if(and)  { break; }} // AND conjunction: exit for name loop if condition not met
            }
        }    
    } else {
        console.error(`unrecognized condition: ${JSON.stringify(condition)}`);
        return false;
    }
    return and? andResult : orResult;
}
&nbsp;
/**
 * filters a `Data` object for the given `Condition`s and returns a new `Data` object with those rows for which
 * `cond` holds true.
 * @param data the `Data` object to filter
 * @param cond the complex condition to test against
 * @return a new `Data` object with the filtered rows 
 */
export function filter(data:Data, cond:Condition):Data {
    const colNumber = (name:string):number =&gt; data.colNumber(name);
    try {
        return new Data({
            name:     data.getName(),
            colNames: data.colNames(), 
            rows:data.getData().filter((row:DataRow, i:number) =&gt; {
                const keep = resolveCondition(cond, row, i, colNumber);
                return keep;
            })
        });
    } catch(err) {
<span class="cstat-no" title="statement not covered" >        console.log(err);</span>
<span class="cstat-no" title="statement not covered" >        console.log(err.stack);</span>
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->

</div>
<script src="prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="sorter.js"></script>
</body>
</html>
